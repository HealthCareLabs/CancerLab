{"version":3,"sources":["reqHandler-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled.js"],"names":[],"mappings":"AAAA;;;;;;AAMA,IAAI,OAAO,QAAQ,GAAR,KAAgB,QAA3B;AACA,IAAI,MAAM,QAAQ,OAAO,KAAf,EAAsB,MAAtB,CAAV;AACA,IAAI,UAAU,QAAQ,OAAO,eAAf,EAAgC,OAA9C;;AAEA,SAAS,kBAAT,CAA4B,GAA5B,EAAiC;AAC7B,QAAI,CAAC,IAAI,GAAJ,CAAQ,WAAR,CAAL,EAA2B;AACvB,eAAO,KAAP;AACH;AACD,QAAI,QAAQ,IAAI,GAAJ,CAAQ,WAAR,CAAZ;AACA,YAAQ,GAAR,CAAY,KAAZ;;AAEA,YAAQ,OAAR,CAAgB,EAAE,QAAQ,KAAV,EAAhB,EAAmC,UAAU,GAAV,EAAe,OAAf,EAAwB;AACvD,YAAI,GAAJ,EAAS;AACL,mBAAO,KAAP;AACH;AACD,YAAI,CAAC,OAAL,EAAc,OAAO,KAAP;AACd,YAAI,CAAC,QAAQ,WAAR,CAAoB,KAApB,CAAL,EAAiC;AAC7B,mBAAO,KAAP;AACH;AACD,YAAI,YAAJ,GAAmB,QAAnB;AACA,YAAI,IAAJ,GAAW,OAAX;AACA,gBAAQ,GAAR,CAAY,MAAZ;AACA,eAAO,IAAP;AACH,KAZD;AAaH;;AAED,IAAI,aAAa,SAAS,UAAT,CAAoB,WAApB,EAAiC,UAAjC,EAA6C;AAC1D,WAAO,UAAU,GAAV,EAAe,GAAf,EAAoB,IAApB,EAA0B;AAC7B,YAAI,CAAC,UAAD,IAAe,WAAnB,EAAgC;AAC5B,gBAAI,mBAAmB,GAAnB,CAAJ,EAA6B;AACzB,oBAAI,YAAJ,GAAmB,QAAnB;AACA;AACH;AACJ;;AAED,YAAI,CAAC,WAAL,EAAkB;AACd,gBAAI,IAAI,eAAJ,EAAJ,EAA2B;AAC9B;;AAED,YAAI,eAAe,UAAnB,EAA+B;AAC3B,gBAAI,CAAC,IAAI,eAAJ,EAAL,EAA4B;AACxB,wBAAQ,GAAR,CAAY,eAAZ;AACA,oBAAI,mBAAmB,GAAnB,CAAJ,EAA6B;AACzB,wBAAI,YAAJ,GAAmB,QAAnB;AACA;AACH,iBAHD,MAGO;AACH,2BAAO,IAAI,IAAJ,CAAS,EAAE,OAAO,cAAT,EAAT,CAAP;AACH;AACJ,aARD,MAQO;AACH;AACH;AACJ;AACJ,KAzBD;AA0BH,CA3BD;;AA6BA,OAAO,OAAP,CAAe,UAAf,GAA4B,UAA5B","file":"reqHandler-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled.js","sourcesContent":["'use strict';\n\n/**\r\n * Created by AsTex on 27.06.2016.\r\n */\n\nvar libs = process.cwd() + '/libs/';\nvar log = require(libs + 'log')(module);\nvar Patient = require(libs + 'model/patient').Patient;\n\nfunction isApiAuthenticated(req) {\n    if (!req.get('X-API-KEY')) {\n        return false;\n    }\n    var token = req.get('X-API-KEY');\n    console.log(token);\n\n    Patient.findOne({ apiKey: token }, function (err, patient) {\n        if (err) {\n            return false;\n        }\n        if (!patient) return false;\n        if (!patient.checkApiKey(token)) {\n            return false;\n        }\n        req.authStrategy = 'Header';\n        req.user = patient;\n        console.log('true');\n        return true;\n    });\n}\n\nvar isLoggedIn = function isLoggedIn(patientArea, doctorArea) {\n    return function (req, res, next) {\n        if (!doctorArea && patientArea) {\n            if (isApiAuthenticated(req)) {\n                req.authStrategy = 'Header';\n                next();\n            }\n        }\n\n        if (!patientArea) {\n            if (req.isAuthenticated()) next();\n        }\n\n        if (patientArea && doctorArea) {\n            if (!req.isAuthenticated()) {\n                console.log('must be there');\n                if (isApiAuthenticated(req)) {\n                    req.authStrategy = 'Header';\n                    next();\n                } else {\n                    return res.send({ error: 'Unauthorized' });\n                }\n            } else {\n                next();\n            }\n        }\n    };\n};\n\nmodule.exports.isLoggedIn = isLoggedIn;\n\n//# sourceMappingURL=reqHandler-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=reqHandler-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled-compiled.js.map"]}